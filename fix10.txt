Problem: Client-side PDF extraction fails because pdf.js worker can't be loaded from CDN. The worker URL version mismatch or CORS issues are causing the failure.

Solution: Use pdf.js WITHOUT the web worker (single-threaded mode). This is simpler and works reliably in all environments.

Step 1: Update the client-side PDF extractor

File: lib/pdfExtractor.ts

import * as pdfjsLib from 'pdfjs-dist';

// Disable worker - use single-threaded mode (simpler and works everywhere)
pdfjsLib.GlobalWorkerOptions.workerSrc = '';

export async function extractTextFromPDF(file: File): Promise<string> {
  try {
    const arrayBuffer = await file.arrayBuffer();
    const uint8Array = new Uint8Array(arrayBuffer);
    
    // Load PDF document without worker
    const loadingTask = pdfjsLib.getDocument({
      data: uint8Array,
      useWorkerFetch: false,
      isEvalSupported: false,
      useSystemFonts: true,
    });
    
    const pdf = await loadingTask.promise;
    const textParts: string[] = [];
    
    // Extract text from each page
    for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
      const page = await pdf.getPage(pageNum);
      const textContent = await page.getTextContent();
      
      let lastY = -1;
      let pageText = '';
      
      for (const item of textContent.items) {
        if ('str' in item && item.str) {
          // Add newline when Y position changes significantly (new line)
          if (lastY !== -1 && Math.abs(lastY - item.transform[5]) > 5) {
            pageText += '\n';
          }
          pageText += item.str + ' ';
          lastY = item.transform[5];
        }
      }
      
      textParts.push(pageText.trim());
    }
    
    return textParts.join('\n\n');
  } catch (error: any) {
    console.error('PDF extraction error:', error);
    throw new Error('Failed to extract text from PDF: ' + error.message);
  }
}
Step 2: Update the pages that use PDF upload

Update the file upload handler in these files:

app/linkedin-optimizer/page.tsx
app/interview-prep/page.tsx
app/generate/page.tsx (if applicable)
Replace the handleFileUpload function with:

// At the top of the file, add import:
import { extractTextFromPDF } from '@/lib/pdfExtractor';

// Update the handleFileUpload function:
const handleFileUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {
  const file = e.target.files?.[0];
  if (!file) return;

  setResumeFile(file);
  setError(''); // Clear any previous errors
  
  const fileName = file.name.toLowerCase();

  try {
    if (fileName.endsWith('.pdf')) {
      // Extract PDF text on client side (no server needed)
      console.log('Extracting text from PDF client-side...');
      const text = await extractTextFromPDF(file);
      
      if (!text || text.trim().length < 50) {
        setError('Could not extract text from PDF. The file may be image-based (scanned). Please try a DOCX file.');
        return;
      }
      
      setResumeContent(text);
      console.log('PDF text extracted successfully:', text.length, 'characters');
      
    } else if (fileName.endsWith('.docx') || fileName.endsWith('.txt')) {
      // For DOCX and TXT, use server-side extraction
      const formData = new FormData();
      formData.append('file', file);

      const response = await fetch('/api/extract-text', {
        method: 'POST',
        body: formData,
      });

      if (response.ok) {
        const data = await response.json();
        setResumeContent(data.text);
      } else {
        const errorData = await response.json();
        setError(errorData.error || 'Failed to extract text from file');
      }
      
    } else if (fileName.endsWith('.doc')) {
      setError('Old .doc format is not supported. Please save as .docx or .pdf');
      
    } else {
      setError('Unsupported file format. Please upload PDF, DOCX, or TXT file.');
    }
    
  } catch (err: any) {
    console.error('File extraction error:', err);
    setError(err.message || 'Failed to read file. Please try another file.');
  }
};
Step 3: Simplify the server-side route (only for DOCX/TXT now)

File: app/api/extract-text/route.ts

import { NextRequest, NextResponse } from 'next/server';

export async function POST(req: NextRequest) {
  try {
    const formData = await req.formData();
    const file = formData.get('file') as File;

    if (!file) {
      return NextResponse.json(
        { error: 'No file provided' },
        { status: 400 }
      );
    }

    const fileName = file.name.toLowerCase();
    const arrayBuffer = await file.arrayBuffer();
    const buffer = Buffer.from(arrayBuffer);

    let text = '';

    if (fileName.endsWith('.txt')) {
      // Plain text file
      text = buffer.toString('utf-8');
      
    } else if (fileName.endsWith('.docx')) {
      // DOCX file
      try {
        const mammoth = await import('mammoth');
        const result = await mammoth.extractRawText({ buffer });
        text = result.value;
      } catch (docxError: any) {
        console.error('DOCX extraction error:', docxError);
        return NextResponse.json(
          { error: 'Failed to extract text from DOCX file: ' + docxError.message },
          { status: 500 }
        );
      }
      
    } else if (fileName.endsWith('.pdf')) {
      // PDF should be handled client-side, but provide fallback message
      return NextResponse.json(
        { error: 'PDF files should be processed in browser. Please refresh and try again.' },
        { status: 400 }
      );
      
    } else if (fileName.endsWith('.doc')) {
      return NextResponse.json(
        { error: 'Old .doc format is not supported. Please convert to .docx' },
        { status: 400 }
      );
      
    } else {
      return NextResponse.json(
        { error: 'Unsupported file format. Please upload DOCX or TXT file.' },
        { status: 400 }
      );
    }

    // Clean up the extracted text
    text = text
      .replace(/\r\n/g, '\n')
      .replace(/\r/g, '\n')
      .replace(/\n{3,}/g, '\n\n')
      .trim();

    if (!text || text.length < 20) {
      return NextResponse.json(
        { error: 'Could not extract meaningful text from file.' },
        { status: 400 }
      );
    }

    return NextResponse.json({
      success: true,
      text,
      fileName: file.name,
      fileSize: file.size,
      characterCount: text.length,
    });
    
  } catch (error: any) {
    console.error('Text extraction error:', error);
    return NextResponse.json(
      { error: 'Failed to process file: ' + error.message },
      { status: 500 }
    );
  }
}
Summary of changes:

File	Change
lib/pdfExtractor.ts	New file - client-side PDF extraction without worker
app/linkedin-optimizer/page.tsx	Update handleFileUpload to use client-side PDF extraction
app/interview-prep/page.tsx	Update handleFileUpload to use client-side PDF extraction
app/api/extract-text/route.ts	Simplified - only handles DOCX and TXT
Git commands:

git add .
git commit -m "Fix: Client-side PDF extraction without worker, server-side for DOCX/TXT only"
git push origin main